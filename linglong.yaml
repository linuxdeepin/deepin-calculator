# SPDX-FileCopyrightText: 2024 - 2026 UnionTech Software Technology Co., Ltd.
#
# SPDX-License-Identifier: GPL-3.0-or-later

version: '1'

package:
  id: org.deepin.calculator
  name: deepin-calculator
  version: 6.5.33.1
  kind: app
  description: |
    Calculator for UOS

command:
  - deepin-calculator

base: org.deepin.base/25.2.2
runtime: org.deepin.runtime.dtk/25.2.2

build: |
  # 下载和安装依赖
  apt -y install --download-only libdtk6gui-dev libdtk6widget-dev qt6-svg-dev qt6-tools-dev qt6-tools-dev-tools libgtest-dev libgmock-dev qt6-base-dev qt6-base-dev-tools qt6-base-private-dev qt6-l10n-tools
  bash ./install_dep /var/cache/apt/archives "$PREFIX"

  # add path for searching OpenGL
  export PATH=$PATH:/runtime/include:/runtime/lib/${TRIPLET}

  VERSION=$(head -1 debian/changelog | awk -F'[()]' '{print $2}')
  cmake -B build \
        -DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX=${PREFIX} \
        -DCMAKE_INSTALL_LIBDIR=${PREFIX}/lib/${TRIPLET} \
        -DVERSION=${VERSION}
  cmake --build build -j`nproc`
  cmake --build build --target install >install.log 2>&1

  # 项目生成应用名和动态隐式加载的依赖库，ldd无法找到的其他库
  LDD_FILES=(
    deepin-calculator
  )

  # 生成.install 文件
  bash ./deploy_dep "${LDD_FILES[@]}"

# allow apt download in build and do apt update
buildext:
  apt:
    build_depends:
      - libc6
